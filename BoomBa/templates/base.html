<!DOCTYPE html>
<html lang="en">
{% load static %}

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css"
        integrity="sha512-YWzhKL2whUzgiheMoBFwW8CKV4qpHQAEuvilg9FAn5VJUDwKZZxkJNuGM4XkWuk94WCrrwslk8yWNGmY1EduTA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />


    <style>

    </style>
    <title>BoomBa</title>
</head>

<body>

    <div class="main-container">


    <div id="song-container">
        {% for song in songs %}
        <div class="song">
            <div class="song_info">
                <img src="/media/{{song.image}}">
                <div class="titles">
                    <h1 id="title{{forloop.counter0}}">{{ song.title }}</h1>
                    <p id="artist{{forloop.counter0}}">Artist: {{ song.artist }}</p>
                </div>
            </div>



            <audio controls>
                <source src="/media/{{ song.audio_file}}" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>
        </div>
        {% endfor %}
    </div>

    <div id="button-container">
        <button id="prev-button">Previous Song</button>
        <button id="play-pause-button">Play/Pause</button>
        <button id="next-button">Next Song</button>
    </div>

    </div>

    <a class="add-button" href="/add"><i class="fas fa-plus"></i></a>




    <script>
        document.addEventListener('DOMContentLoaded', function() {
    const songs = document.querySelectorAll('.song');
    let currentSongIndex = 0;
    let currentAudioPlayer;

    // Function to hide all songs
    const hideAllSongs = () => {
        songs.forEach(song => {
            song.style.display = 'none';
        });
    };

    // Function to show the current song
    const showCurrentSong = () => {
        hideAllSongs();
        songs[currentSongIndex].style.display = 'block';
    };

    // Function to play or pause the current song
    const playPause = () => {
        const audioPlayer = songs[currentSongIndex].querySelector('.audio-player');
        if (audioPlayer.paused) {
            audioPlayer.play();
        } else {
            audioPlayer.pause();
        }
    };

    // Function to stop the current song and reset its position
    const stopCurrentSong = () => {
        if (currentAudioPlayer) {
            currentAudioPlayer.pause();
            currentAudioPlayer.currentTime = 0; // Reset the playback position
        }
    };

    // Function to play the next song
    const nextSong = () => {
        // Stop the currently playing song
        stopCurrentSong();

        // Move to the next song
        currentSongIndex = (currentSongIndex + 1) % songs.length;
        showCurrentSong();

        // Play the next song immediately
        const nextAudioPlayer = songs[currentSongIndex].querySelector('.audio-player');
        nextAudioPlayer.play();
        currentAudioPlayer = nextAudioPlayer;
    };

    // Function to play the previous song
    const prevSong = () => {
        // Stop the currently playing song
        stopCurrentSong();

        // Move to the previous song
        currentSongIndex = (currentSongIndex - 1 + songs.length) % songs.length;
        showCurrentSong();

        // Play the previous song immediately
        const prevAudioPlayer = songs[currentSongIndex].querySelector('.audio-player');
        prevAudioPlayer.play();
        currentAudioPlayer = prevAudioPlayer;
    };

    // Function to handle seeking within the audio track
    const seekTo = (event) => {
        const progressDiv = event.currentTarget;
        const audioPlayer = progressDiv.parentElement.querySelector('.audio-player');
        const seekPosition = (event.offsetX / progressDiv.clientWidth) * audioPlayer.duration;
        audioPlayer.currentTime = seekPosition;
    };

    // Event listeners for buttons
    document.getElementById('play-pause-button').addEventListener('click', playPause);
    document.getElementById('next-button').addEventListener('click', nextSong);
    document.getElementById('prev-button').addEventListener('click', prevSong);

    // Event listener for seeking within the audio track
    document.querySelectorAll('.progress_div').forEach(progressDiv => {
        progressDiv.addEventListener('click', seekTo);
    });

    // Initial setup
    showCurrentSong();
});

    </script>
</body>

</html>